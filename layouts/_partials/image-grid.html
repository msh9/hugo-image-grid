{{/*
  Renders a responsive image grid from a normalized slice of dicts:
    [{ src, href, alt }, ...]
  No lookup or business logic here; callers must normalize.
*/}}

<ul class="grid" aria-label="Image grid">
  {{ range $i, $resources := . }}
    {{ with $original := index $resources "original" }}
    <li class="grid-item">
      {{ $originalLink := $original.RelPermalink }}
      <a href="{{ $originalLink }}">
        <picture>
          {{/* the following safely dereferences the pointers to multiple resources objects in the given bundle */}}
          {{ with $small := index $resources "400w" }}
            {{ with $medium := index $resources "800w" }}
              <source type="{{ $small.MediaType.Type }}" size="(width <= 1024px) 280px, 320px" srcset="{{ $small.RelPermalink }} 400w, {{ $medium.RelPermalink }} 800w">
            {{ else }}
              <source type="{{ $small.MediaType.Type }}" size="(width <= 1024px) 280px" srcset="{{ $small.RelPermalink }} 400w">
            {{ end }}
          {{ else }}
            {{ with $medium := index $resources "800w" }}
              <source type="{{ $medium.MediaType.Type }}" size="(width <= 1024px) 280px" srcset="{{ $medium.RelPermalink }} 800w">
            {{ end }}
          {{ end }}
          {{/* Alternate fallback format: single original, no size-aware srcset */}}
          {{ $imgSrc := $originalLink }}
          {{ with $alt := index $resources "alt" }}
            {{ $imgSrc = $alt.RelPermaLink }}
          {{ end }}
          <img loading="lazy" src="{{ $imgSrc }}" alt="{{ $original.Name }}" />
        </picture>
      </a>
    </li>
    {{ end }}
  {{ end }}
</ul>
